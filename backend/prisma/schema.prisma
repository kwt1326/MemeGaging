// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model creator {
  id             Int      @id @default(autoincrement())
  memex_user_id  Int      @unique        // mock-user-data 의 id
  user_name      String                  // "zIfjpicANr"
  display_name   String                  // "Vesta.Crona"
  user_name_tag  String?                 // "e93cD9" (null 가능)
  wallet_address String                  // "0x26A9..."
  access_token   String                  // MemeX API 호출용

  meme_score     Float    @default(0)    // 최근 7일 계산한 MemeScore

  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt

  tips_received  tip[]    @relation("creator_tips_received")
  tips_sent      tip[]    @relation("creator_tips_sent")
  scores         score[]
}

model tip {
  id              Int      @id @default(autoincrement())
  from_creator_id Int?
  to_creator_id   Int
  token_address   String                     // 크리에이터 토큰 주소
  amount          Decimal @db.Decimal(78, 0) // on-chain amount (wei 등)
  tx_hash         String  @unique
  created_at      DateTime @default(now())

  from_creator creator? @relation("creator_tips_sent", fields: [from_creator_id], references: [id])
  to_creator   creator  @relation("creator_tips_received", fields: [to_creator_id], references: [id])
}

model score {
  id                Int      @id @default(autoincrement())
  creator_id        Int      @unique
  engagement_score  Float    @default(0)
  view_score        Float    @default(0)
  follow_score      Float    @default(0)
  tip_score         Float    @default(0)
  meme_score        Float    @default(0)
  
  // Raw stats used for calculation
  likes             Int      @default(0)
  replies           Int      @default(0)
  reposts           Int      @default(0)
  quotes            Int      @default(0)
  views             Int      @default(0)
  followers         Int      @default(0)
  tip_count         Int      @default(0)
  tip_amount        String   @default("0")  // wei 단위
  
  created_at        DateTime @default(now())
  
  creator           creator  @relation(fields: [creator_id], references: [id])
  
  @@index([creator_id, created_at])
  @@index([meme_score])
}
